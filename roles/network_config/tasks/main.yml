---
#- name: create git repo
#  git:
#    repo: https://{{ gitusername | urlencode }}:{{ gitpassword }}@{{ git_url }}
#    dest: /var/tmp/tower-config-repo
#    update: yes
#    version: master

- name: Ensure that the /var/tmp/tower-config-repo directory is present
  file:
      path: /var/tmp/tower-config-repo/configs
      state: directory

- name: create {{ device_os }} configuration file
  template:
    src: templates/{{ device_os }}.j2
    dest: /var/tmp/tower-config-repo/configs/{{ device_os }}-{{ ansible_date_time.iso8601_basic_short }}.conf

#- name: add template to git
#  command: "git add --all"
#  args:
#    chdir: /var/tmp/tower-config-repo/
#  register: gitadd

#- name: commit to git
#  command: git commit -a -m "added config for {{ device_os }}-{{ ansible_date_time.date }}-{{ #ansible_date_time.time }}"
#  args:
#    chdir: /var/tmp/tower-config-repo/
#  register: gitcommit

#- name: push to git
#  command: git push
#  args:
#    chdir: /var/tmp/tower-config-repo/
#  register: gitpush
